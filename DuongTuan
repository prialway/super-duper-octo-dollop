local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local RecordButton = Instance.new("TextButton")
local PlayButton = Instance.new("TextButton")
local TelelobbyButton = Instance.new("TextButton")

-- Cài đặt GUI
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Size = UDim2.new(0, 300, 0, 140)
Frame.Position = UDim2.new(0.5, -150, 0.5, -70)

-- Nút Recording
RecordButton.Parent = Frame
RecordButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RecordButton.Position = UDim2.new(0, 10, 0, 10)
RecordButton.Size = UDim2.new(0, 130, 0, 40)
RecordButton.Text = "Recording (Off)"

-- Nút Play
PlayButton.Parent = Frame
PlayButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PlayButton.Position = UDim2.new(0, 10, 0, 60)
PlayButton.Size = UDim2.new(0, 130, 0, 40)
PlayButton.Text = "Play"

-- Nút Telelobby
TelelobbyButton.Parent = Frame
TelelobbyButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
TelelobbyButton.Position = UDim2.new(0, 160, 0, 10)
TelelobbyButton.Size = UDim2.new(0, 130, 0, 40)
TelelobbyButton.Text = "Telelobby"

-- Thông báo debug
print("Nút Telelobby đã được tạo và thêm vào Frame")

-- Biến ghi lại hành động
local recording = false
local actions = {}

-- Bắt đầu hoặc dừng ghi
RecordButton.MouseButton1Click:Connect(function()
    recording = not recording
    if recording then
        RecordButton.Text = "Recording (On)"
        actions = {} -- Làm sạch danh sách hành động khi bắt đầu ghi mới
    else
        RecordButton.Text = "Recording (Off)"
    end
end)

-- Ghi lại hành động di chuyển và đặt unit
local function recordAction(actionType, unitName, position)
    if recording then
        table.insert(actions, {type = actionType, unit = unitName, position = position, time = tick()})
        print("Ghi lại hành động:", actionType, unitName, position)
    end
end

-- Ghi lại hành động di chuyển
local function onCharacterMoved()
    if recording then
        local player = game.Players.LocalPlayer
        local position = player.Character.PrimaryPart.Position
        recordAction("Move", nil, position)
    end
end

-- Kết nối sự kiện di chuyển
game.Players.LocalPlayer.Character.Humanoid.Running:Connect(onCharacterMoved)

-- Ghi lại hành động đặt unit
game:GetService("Players").LocalPlayer.Character.ChildAdded:Connect(function(child)
    if child:IsA("Model") then
        local position = child:GetPrimaryPartCFrame().p
        recordAction("Place", child.Name, position)
    end
end)

-- Phát lại hành động đã ghi
PlayButton.MouseButton1Click:Connect(function()
    local startTime = tick()
    for _, action in ipairs(actions) do
        local elapsedTime = tick() - startTime
        local waitTime = action.time - elapsedTime
        if waitTime > 0 then
            wait(waitTime)
        end

        if action.type == "Place" then
            -- Tái tạo hành động đặt unit
            local unitClone = game:GetService("ReplicatedStorage"):FindFirstChild(action.unit):Clone()
            unitClone.Parent = game.Workspace
            unitClone:SetPrimaryPartCFrame(CFrame.new(action.position))
        elseif action.type == "Move" then
            -- Tái tạo hành động di chuyển (cần xử lý logic di chuyển người chơi nếu cần)
            print("Di chuyển đến vị trí", action.position)
            -- Ví dụ: Thay đổi vị trí của người chơi (chỉ áp dụng nếu hợp lý trong game)
            game.Players.LocalPlayer.Character.PrimaryPart.CFrame = CFrame.new(action.position)
        end
    end
end)

-- Đưa người chơi về lobby
TelelobbyButton.MouseButton1Click:Connect(function()
    -- Ví dụ: Di chuyển người chơi về một vị trí cụ thể trong lobby
    local lobbyPosition = Vector3.new(0, 50, 0) -- Cập nhật vị trí lobby theo yêu cầu của bạn
    game.Players.LocalPlayer.Character:SetPrimaryPartCFrame(CFrame.new(lobbyPosition))
    print("Đưa người chơi về lobby tại vị trí", lobbyPosition)
end)
