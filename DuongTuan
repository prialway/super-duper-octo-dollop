local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local MacroButton = Instance.new("TextButton")
local RecordingButton = Instance.new("TextButton")
local PlayButton = Instance.new("TextButton")

-- Cài đặt GUI
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Size = UDim2.new(0, 300, 0, 100)
Frame.Position = UDim2.new(0.5, -150, 0.5, -50)

-- Nút Macro
MacroButton.Parent = Frame
MacroButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
MacroButton.Size = UDim2.new(0, 300, 0, 40)
MacroButton.Position = UDim2.new(0, 0, 0, 0)
MacroButton.Text = "Macro"

-- Nút Recording
RecordingButton.Parent = Frame
RecordingButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RecordingButton.Position = UDim2.new(0, 10, 0, 50)
RecordingButton.Size = UDim2.new(0, 130, 0, 40)
RecordingButton.Text = "Recording (Off)"
RecordingButton.Visible = false

-- Nút Play
PlayButton.Parent = Frame
PlayButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PlayButton.Position = UDim2.new(0, 160, 0, 50)
PlayButton.Size = UDim2.new(0, 130, 0, 40)
PlayButton.Text = "Play"
PlayButton.Visible = false

-- Biến ghi lại hành động
local recording = false
local actions = {}
local macroVisible = false

-- Bắt đầu hoặc dừng ghi
RecordingButton.MouseButton1Click:Connect(function()
    recording = not recording
    if recording then
        RecordingButton.Text = "Recording (On)"
        actions = {} -- Làm sạch danh sách hành động khi bắt đầu ghi mới
    else
        RecordingButton.Text = "Recording (Off)"
    end
end)

-- Ghi lại hành động di chuyển và đặt unit
local function recordAction(actionType, unitName, position)
    if recording then
        table.insert(actions, {type = actionType, unit = unitName, position = position, time = tick()})
        print("Ghi lại hành động:", actionType, unitName, position)
    end
end

-- Ghi lại hành động di chuyển
local function onCharacterMoved()
    if recording then
        local player = game.Players.LocalPlayer
        local position = player.Character.PrimaryPart.Position
        recordAction("Move", nil, position)
    end
end

-- Kết nối sự kiện di chuyển
game.Players.LocalPlayer.Character.Humanoid.Running:Connect(onCharacterMoved)

-- Ghi lại hành động đặt unit
game:GetService("Players").LocalPlayer.Character.ChildAdded:Connect(function(child)
    if child:IsA("Model") then
        local position = child:GetPrimaryPartCFrame().p
        recordAction("Place", child.Name, position)
    end
end)

-- Phát lại hành động đã ghi
PlayButton.MouseButton1Click:Connect(function()
    local startTime = tick()
    for _, action in ipairs(actions) do
        local elapsedTime = tick() - startTime
        local waitTime = action.time - elapsedTime
        if waitTime > 0 then
            wait(waitTime)
        end

        if action.type == "Place" then
            -- Tái tạo hành động đặt unit
            local unitClone = game:GetService("ReplicatedStorage"):FindFirstChild(action.unit):Clone()
            unitClone.Parent = game.Workspace
            unitClone:SetPrimaryPartCFrame(CFrame.new(action.position))
        elseif action.type == "Move" then
            -- Tái tạo hành động di chuyển (cần xử lý logic di chuyển người chơi nếu cần)
            print("Di chuyển đến vị trí", action.position)
            -- Ví dụ: Thay đổi vị trí của người chơi (chỉ áp dụng nếu hợp lý trong game)
            game.Players.LocalPlayer.Character.PrimaryPart.CFrame = CFrame.new(action.position)
        end
    end
end)

-- Hiển thị hoặc ẩn các nút Recording và Play
MacroButton.MouseButton1Click:Connect(function()
    macroVisible = not macroVisible
    RecordingButton.Visible = macroVisible
    PlayButton.Visible = macroVisible
end)
